name: Sync Docs to Dify

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      reason:
        description: 'åŒæ­¥åŸå› '
        required: false
        default: 'æ‰‹åŠ¨è§¦å‘æ–‡æ¡£åŒæ­¥'
  
  # å¯é€‰ï¼šå®šæœŸåŒæ­¥ï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨æ‰§è¡Œï¼‰
  # schedule:
  #   - cron: '0 0 * * 0'

# è®¾ç½®æƒé™
permissions:
  contents: read

jobs:
  sync:
    runs-on: ubuntu-latest
    name: åŒæ­¥æ–‡æ¡£åˆ°DifyçŸ¥è¯†åº“
    
    steps:
      - name: Checkoutä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      - name: è®¾ç½®Node.jsç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: npm
      
      - name: å®‰è£…ä¾èµ–
        run: npm ci
      
      - name: åŒæ­¥æ–‡æ¡£åˆ°Dify
        env:
          DIFY_API_KEY: ${{ secrets.DIFY_API_KEY }}
          DIFY_DATASET_ID: ${{ secrets.DIFY_DATASET_ID }}
          DIFY_BASE_URL: ${{ secrets.DIFY_BASE_URL || 'https://api.dify.ai/v1' }}
        run: |
          echo "ğŸš€ å¼€å§‹åŒæ­¥æ–‡æ¡£åˆ°DifyçŸ¥è¯†åº“..."
          echo "åŸå› : ${{ github.event.inputs.reason || 'å®šæœŸåŒæ­¥' }}"
          node scripts/sync-to-dify.mjs
      
      - name: åŒæ­¥ç»“æœé€šçŸ¥
        if: always()
        run: |
          if [ $? -eq 0 ]; then
            echo "âœ… æ–‡æ¡£åŒæ­¥æˆåŠŸï¼"
          else
            echo "âŒ æ–‡æ¡£åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ã€‚"
            exit 1
          fi
